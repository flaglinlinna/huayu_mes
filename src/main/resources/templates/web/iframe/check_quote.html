<!DOCTYPE html>
<html  xmlns:th="http://www.thymeleaf.org"
       xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head th:include="layout :: htmlhead" th:with="title='审批-报价'"></head>
<style>
    body{padding:10px; font-size:14px; background:#fff; width:95%; margin:0 auto; font-size:14px; line-height:20px; overflow:hidden;}
        p{margin-bottom:10px;}
        input{border:1px solid #999; padding:5px 10px; margin:0 10px 10px 0;}
        .ap-foot{
            border-top:1px solid #e6e6e6;
        }
        .layui-timeline-item{padding-bottom:0px;}
        
        ul{margin:0px; padding:0px; list-style:none;}
 .wrap{width:960px; height:auto; line-height:30px; margin:auto 0;}
 .step-case{height:40px;}
     .step-case li{ float:left; margin:0px; width:12.5%;position:relative; cursor:pointer;}
     .step-case li span{display:block; background-color:#ccc;  height:40px; line-height:40px;  text-align:center; color:#fff; font-weight:bold;}
     .step-case b{position:absolute; font-size:0px; line-height:0px; top:0px;}
     .step-case .b-l{border-width:2px 2px 2px 0; border-style:dashed solid dashed dashed; border-color:transparent #ccc transparent transparent; height:36px; left:-2px;}
     .step-case .b-r{border-width:2px 0 2px 2px; border-style:dashed dashed dashed solid; border-color:transparent transparent transparent #ccc; height:36px; right:-2px;}
     .step-case .b-1{border-width:20px 0 20px 20px; border-style:solid dashed solid solid; border-color:#ccc transparent #ccc #ddd; left:-20px;}
     .step-case .b-2{border-width:20px 0 20px 20px; border-style:dashed dashed dashed solid; border-color:transparent transparent transparent #ccc; left:-21px;}
     /*当前状态*/
     .step-case .s-cur span{background-color:orange;}
     .step-case .s-cur .b-l{border-right-color:orange;}
     .step-case .s-cur .b-r{border-left-color:orange;}
     .step-case .s-cur .b-1{border-color:orange orange orange #FABF55;}
     .step-case .s-cur .b-2{border-left-color:#FADBA5;}
     /*当前状态后*/
     .step-case .s-cur-next .b-2{border-color:transparent transparent transparent orange;}
     /*完成的状态*/
     .step-case .s-finish span{background-color:#FADBA5; color:#000;}
     .step-case .s-finish .b-l{border-right-color:#FADBA5;}
     .step-case .s-finish .b-r{border-left-color:#FADBA5;}
     .step-case .s-finish .b-1{border-color:#FADBA5 #FADBA5 #FADBA5 #FABF55;}
     .step-case .s-finish .b-2{border-left-color:#FADBA5;}
</style>
<body class="layui-layout-body">
<fieldset class="layui-elem-field" id="infoDiv">
    <legend>审批流程说明:</legend>
    <div class="layui-field-box" id="flow_info">
        <div class="wrap" style="width: 1400px">
		    <ul class="step-case" id="step"> 
		    <li class="s-cur" id="li-1"><span id="span-1">第1步</span><b class="b-l"></b></li>
		        <li class="s-cur-next" id="li-2"><span id="span-2">第2步</span><b class="b-1"></b><b class="b-2"></b></li>
		        <li id="li-3"><span id="span-3">第3步</span ><b class="b-1"></b><b class="b-2"></b></li>
		        <!-- <li class="s-finish"><span>第1步</span><b class="b-l"></b></li>
		        <li class="s-finish"><span>第2步</span><b class="b-1"></b><b class="b-2"></b></li>
		        <li class="s-cur"><span>第3步</span><b class="b-1"></b><b class="b-2"></b></li>
		        <li class="s-cur-next"><span>第4步</span><b class="b-1"></b><b class="b-2"></b></li>
		        <li><span>第5步</span><b class="b-1"></b><b class="b-2"></b></li> -->
		    </ul>
		</div>
    </div>
</fieldset>
<hr>
<div class="layui-card">
    <div id ="pageInfo">
        <div class="layui-card-body"  style="height:120px;overflow:auto" >
            <ul class="layui-timeline" id="timeline">
    1
            </ul>

        </div>
    </div>
</div>

<script>
    function getInfo(json){
        $.ajax({
            url: context+'/check/getInfo',
            type: "post",
            data: json,
            dataType: "json",
            success: function (res) {
                console.log(res);
                if(res.result===true){
                    var workFlow = res.data.Lw;
                    for(var i =0;i<res.data.Lw.length;i++){
                        if(workFlow[i].bsCheckGrade ==1){
                            $("#span-1").html(workFlow[i].bsStepName)
                        }else if(workFlow[i].bsCheckGrade ==2){
                            $("#span-2").html(workFlow[i].bsStepName+"("+workFlow[i].bsCheckName+")")
                        }else if(workFlow[i].bsCheckGrade ==3){
                            $("#span-3").html(workFlow[i].bsStepName+"("+workFlow[i].bsCheckName+")")
                        }
                    }
                    var list = res.data;
                    step = list.grade;
                    if(list.grade == '1'){
                        //$("#th").attr("disabled","disabled");//失效
                        $("#low_flag").show();
                    }else{
                        $("#low_flag").hide();
                    }
                    //隐藏
                    if(list.grade == '2'){
                        $("#end-btn").show();
                        $("#end-span").show();
                        $("#sure-span").text("总经理审批");
                    }else{
                        $("#end-btn").hide();
                        $("#end-span").hide();
                        $("#sure-span").text("同意");
                    }
                    //end

                    //已完成
                    if(status == '2'){
                        setLiColor(4)
                    }else{
                        setLiColor(list.grade)
                    }

                    if(list.data.length == 0){
                        document.getElementById('timeline').innerHTML = "";
                    }else{
                        // var timeHtml = '';
                        // for(var i=0; i<list.data.length; i++){
                        //     if(CheckIsNullOrEmpty(list.data[i].lastupdateDate)){
                        //         timeHtml += '<li class="layui-timeline-item">'+ getIcon(list.data[i].bsStepCheckStatus)+
                        //             /*  '<i class="layui-icon '+getIcon(list.data[i].bsStepCheckStatus)+'"></i>'+ */
                        //             ' <div class="layui-timeline-content layui-text">'+
                        //             '  <div class="layui-timeline-title">'+
                        //             '   <span style="padding-right:20px;">'+'['+getRadio(list.data[i].bsStepCheckStatus)+']'+list.data[i].createDate+'</span>  '+list.data[i].bsCheckName+','+list.data[i].bsCheckComments+
                        //             '  </div>'+
                        //             ' </div>'+
                        //             ' </li>';
                        //     }
                        // }
                        // document.getElementById('timeline').innerHTML = timeHtml;
                        // var data = list.data;
                        console.log(list.data.length);
                        //调用分页
                        layui.use(['laypage','layer'], function () {
                            var page = layui.laypage;

                            page.render({
                                elem: 'pageInfo',
                                count: list.data.length,
                                // first: "首页",
                                // last: "尾页",
                                // layout: ['count', 'prev', 'page', 'next', 'limit', 'skip'],
                                jump: function (obj,first) {
                                    arr = [],thisData = list.data.concat().splice(obj.curr*obj.limit - obj.limit, obj.limit);
                                    console.log(thisData);
                                    layui.each(thisData, function(i, item){
                                        arr.push('<li class="layui-timeline-item">'+ getIcon(list.data[i].bsStepCheckStatus)+
                                            /*  '<i class="layui-icon '+getIcon(list.data[i].bsStepCheckStatus)+'"></i>'+ */
                                            ' <div class="layui-timeline-content layui-text">'+
                                            '  <div class="layui-timeline-title">'+
                                            '   <span style="padding-right:20px;">'+'['+getRadio(list.data[i].bsStepCheckStatus)+']'+list.data[i].createDate+'</span>  '+list.data[i].bsCheckName+','+list.data[i].bsCheckComments+
                                            '  </div>'+
                                            ' </div>'+
                                            ' </li>');
                                    });
                                    arr.join('');
                                }
                            });
                        })
                        // document.getElementById('timeline').innerHTML = arr;

                        document.getElementById('timeline').innerHTML = "";
                    }

                }else{
                    layer.msg(res.msg);
                }
                // parent.layer.iframeAuto(index);
            }

        });
    }
</script>
<hr>
<textarea name="desc" id="desc" placeholder="请输入内容" class="layui-textarea"></textarea>
<hr>

<div class="ap-foot">
    <div style="padding:12px 40px 0;">
        <input type="radio" name="checkRadio" value="1" title="同意 " checked><span id="sure-span">总经理审批&nbsp;</span>
        <input type="radio" name="checkRadio" value="2" title="驳回" id="th">驳回
        <input type="radio" name="checkRadio" value="3" title="驳回" id="end-btn"><span id="end-span">同意并且结束流程</span>
        
        <button type="button" class="layui-btn layui-btn-primary layui-btn-sm" data-type="close" style="float:right;margin-left:10px;">取消</button>
        <button type="button" class="layui-btn layui-btn-sm" data-type="submit" style="float:right;margin-left:10px;" id="summit-btn">提交</button>
        <div id="low_flag" style="width:210px;float:right;margin-left:100px;"></div>
    </div>
</div>


<script>
    document.write("<script type='text/javascript' " +
        "src='/js/web/iframe/check_quote.js?ver="+Math.random()+"'><\/script>");
</script>
</body>
</html>