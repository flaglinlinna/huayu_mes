<!DOCTYPE html>
<html  xmlns:th="http://www.thymeleaf.org"
       xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head th:include="layout :: htmlhead" th:with="title='配置'"></head>
<style th:inline="text">
		.layui-form-label{
		   text-align:right;
		}
		.layui-form-switch{
		   margin-top:0px;
		}
		.layui-form-radio{
		  margin:0px 10px 0 0;
		}
	</style>
<body class="layui-layout-body" >
<div class="layui-layout layui-layout-admin">
    <!--头-->
    <!--<div th:replace="fragments/head :: header"></div>-->

    <div style="margin: 10px">
      <form class="layui-form" action="">
	      <div class="layui-collapse" lay-accordion="">
			  <div class="layui-colla-item">
			    <h2 class="layui-colla-title">基础信息配置</h2>
			    <div class="layui-colla-content layui-show">
			      <div class="layui-form-item" style="margin-bottom: 0px">
                           <div class="layui-inline">
				                  <label class="layui-form-label" >接口编号</label>
				                  <div class="layui-input-inline">
				                    <input type="text" name="bsCode" lay-verify="required"  autocomplete="off" placeholder="请输入编号" class="layui-input">
				                  </div>
				                </div>
                            <div class="layui-inline">
                                <label class="layui-form-label">接口名称</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="bsName" lay-verify="required" autocomplete="off" placeholder="请输入名称" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-inline">
				                  <label class="layui-form-label" >接口描述</label>
				                  <div class="layui-input-inline">
				                    <input type="text" name="bsComment"  autocomplete="off" placeholder="请输入描述" class="layui-input" style="width:380px;">
				                  </div>
				                </div>
				            <div class="layui-inline">
				                  <label class="layui-form-label" >是否生效</label>
				                  <div class="layui-input-inline">
				                    <input type="checkbox" checked="" name="bsStatus" lay-skin="switch" lay-filter="switchTest" lay-text="ON|OFF" value="1">
				                  </div>
				                </div>
				                <div class="layui-inline">
				                  <label class="layui-form-label" >执行方式</label>
				                  <div class="layui-input-inline" style="width:480px;">
				                    <input type="radio" name="bsWay" value="1" title="手动执行" checked="">
                                    <input type="radio" name="bsWay" value="2" title="每隔一个小时执行">
                                    <input type="radio" name="bsWay" value="3" title="每天的24点执行">
				                  </div>
				                </div>       
                        </div> 
			    </div>
			  </div>
			  </div>
                      
        <div class="layui-container" style="width:100%;padding:0;">  
		  <div class="layui-row">
		    <div class="layui-col-md6">
			   <fieldset class="layui-elem-field layui-field-title" >
				  <legend>源数据</legend>
				</fieldset>
					  <div class="layui-form-item">
					    <label class="layui-form-label">数据库类型</label>
					    <div class="layui-input-block">
					      <input type="radio" name="bsFromType" value="oracle" title="Oracle" checked="">
					      <input type="radio" name="bsFromType" value="sqlserver" title="SqlServer">
					      <input type="radio" name="bsFromType" value="mysql" title="MySql" >
					    </div>
					  </div>
					  <div class="layui-form-item">
					    <label class="layui-form-label">数据库账号和密码</label>
					    <div class="layui-input-block">
					      <input type="text" name="bsFromName" lay-verify="required" lay-reqtext="数据库账号不允许为空" placeholder="账号" autocomplete="off" class="layui-input" style="width:50%;float:left;">
					      <input type="text" name="bsFromPassword" lay-verify="required" lay-reqtext="数据库密码不允许为空" placeholder="密码" autocomplete="off" class="layui-input" style="width:50%;">
					    </div>
					  </div>
					  <div class="layui-form-item">
					    <label class="layui-form-label">数据库地址</label>
					    <div class="layui-input-block">
					      <input type="text" name="bsFromUrl" lay-verify="required" lay-reqtext="数据库地址不允许为空" placeholder="IP地址:端口号/数据库名" autocomplete="off" class="layui-input" style="width:70%;float:left;">
					      <button type="reset" class="layui-btn layui-btn-primary  layui-btn-sm"  id="testBtnFrom">测试连接</button>
					    </div>
					  </div>
					  <div class="layui-form-item">
					    <label class="layui-form-label"></label>
					    <div class="layui-input-block">
					      <input type="text" disabled style="border:none;"  placeholder="" autocomplete="off" class="layui-input">
					    </div>
					  </div>
					  <div class="layui-form-item">
					    <label class="layui-form-label">主键字段</label>
					    <div class="layui-input-block">
					      <input type="text" name="bsFromKey" lay-verify="required"  placeholder="请输入" autocomplete="off" class="layui-input">
					    </div>
					  </div>
					  <div class="layui-form-item layui-form-text">
					    <label class="layui-form-label">下载SQL</label>
					    <div class="layui-input-block">
					      <textarea  name="bsFromSql"  placeholder="请输入内容" lay-verify="required"class="layui-textarea" style="min-height:200px;"></textarea>
					    </div>
					  </div>
		           </div>

		    <div class="layui-col-md6">
		       <fieldset class="layui-elem-field layui-field-title" >
				  <legend>目标数据</legend>
				</fieldset>
					  <div class="layui-form-item">
					    <label class="layui-form-label">数据库类型</label>
					    <div class="layui-input-block">
					      <input type="radio" name="bsToType" value="oracle" title="Oracle" checked="">
					      <input type="radio" name="bsToType" value="sqlserver" title="SqlServer">
					      <input type="radio" name="bsToType" value="mysql" title="MySql" >
					    </div>
					  </div>
					  <div class="layui-form-item">
					    <label class="layui-form-label">数据库账号和密码</label>
					    <div class="layui-input-block">
					      <input type="text" name="bsToName" lay-verify="required" lay-reqtext="数据库账号不允许为空" placeholder="账号" autocomplete="off" class="layui-input" style="width:50%;float:left;">
					      <input type="text" name="bsToPassword" lay-verify="required" lay-reqtext="数据库密码不允许为空" placeholder="密码" autocomplete="off" class="layui-input" style="width:50%;">
					    </div>
					  </div>
					  <div class="layui-form-item">
					    <label class="layui-form-label">数据库地址</label>
					    <div class="layui-input-block">
					      <input type="text" name="bsToUrl" lay-verify="required"  placeholder="IP地址:端口号/数据库名" autocomplete="off" class="layui-input" style="width:70%;float:left;">
					      <button type="reset" class="layui-btn layui-btn-primary  layui-btn-sm"  id="testBtnTo">测试连接</button>
					    </div>
					  </div>
					  <div class="layui-form-item">
					    <label class="layui-form-label">表名</label>
					    <div class="layui-input-block">
					      <input type="text" name="bsToTable" lay-verify="required"  placeholder="目标数据表" autocomplete="off" class="layui-input">
					    </div>
					  </div>
					  <div class="layui-form-item">
					    <label class="layui-form-label">主键字段</label>
					    <div class="layui-input-block">
					      <input type="text" name="bsToKey" lay-verify="required"  placeholder="与源数据的主键字段一一对应" autocomplete="off" class="layui-input">
					    </div>
					  </div>
  
					  <div class="layui-form-item layui-form-text">
					    <label class="layui-form-label">字段</label>
					    <div class="layui-input-block">
					      <textarea placeholder="以,号隔开" name="bsToField" class="layui-textarea" style="min-height:200px;"></textarea>
					    </div>
					  </div>
		            </div>
		    	</div>
		      </div>
		      <div class="layui-form-item">
			    <div class="layui-input-block">
			      <button type="submit" class="layui-btn  layui-btn-sm" lay-submit="" lay-filter="sunbmitBtn">立即提交</button>
			      <button type="reset" class="layui-btn layui-btn-primary  layui-btn-sm">保存</button>
			    </div>
			  </div>
		    </form>
		  </div>
    </div>

<script  th:inline="none">
		     
		     layui.use(['table','form', 'layedit', 'laydate',], function(){
		    	  var form = layui.form
		    	  ,layer = layui.layer
		    	  ,layedit = layui.layedit
		    	  ,table = layui.table
		    	  ,laydate = layui.laydate;
		    	  
		    	//监听提交
		    	  form.on('submit(sunbmitBtn)', function(data){
		    	    layer.alert(JSON.stringify(data.field), {
		    	      title: '最终的提交信息'
		    	    })
		    	    CoreUtil.sendAjax("api/database/add",JSON.stringify(data.field),function (res) {
						
		    		 layer.msg(res.msg, {
		                    time: 20000, //20s后自动关闭
		                    btn: ['知道了']
		                  });
		            },"POST",false,function (res) {
		                layer.msg("抱歉！您暂无权限");
		            }); 
		    	    return false;
		    	  });
		    	 
		    	  
		    	});
		     
		     $(function () { 
		    	 $(document).on('click',"#testBtnFrom",function(){
		    		// alert($("input[name='pstyle']").val())
		    		 var param = {
		    			type:$("input[name='bsFromType']").val(),
		    			username:$("input[name='bsFromName']").val(),
			    	    url:$("input[name='bsFromUrl']").val(),
			    	    password:$("input[name='bsFromPassword']").val()
			    	    }
		    		 //layer.alert(JSON.stringify(param));
		    		 testConnection(param);
		    		 return false;
		    	 });
		    	 $(document).on('click',"#testBtnTo",function(){
			    		// alert($("input[name='pstyle']").val())
			    		 var param = {
			    			type:$("input[name='bsToType']").val(),
			    			username:$("input[name='bsToName']").val(),
				    	    url:$("input[name='bsToUrl']").val(),
				    	    password:$("input[name='bsToPassword']").val()
				    	    }
			    		 //layer.alert(JSON.stringify(param));
			    		 testConnection(param);
			    		 return false;
			    	 });
		     });
		     
		     function testConnection(param){
		    	 CoreUtil.sendAjax("api/database/testconnection",JSON.stringify(param),function (res) {
						
		    		 layer.msg(res.msg, {
		                    time: 20000, //20s后自动关闭
		                    btn: ['知道了']
		                  });
		            },"POST",false,function (res) {
		                layer.msg("抱歉！您暂无获取菜单权限列表的权限");
		            }); 
		     }

		
</script>
</div>
</body>
</html>